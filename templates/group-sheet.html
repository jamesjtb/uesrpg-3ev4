<form class="{{cssClass}}" autocomplete="off">
  <div class="sheet-section-container">
    <div class="sheet-fixed-container">
      <div class="character-profile-container">
        <div class="profile-img-container">
          <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}">
        </div>

        <nav class="sheet-tabs tabs" data-group="primary">
          <a class="item" data-tab="members">Members</a>
          <a class="item" data-tab="inventory">Inventory</a>
          <a class="item" data-tab="travel">Travel</a>
          <a class="item" data-tab="details">Details</a>
        </nav>

        <div>
          <h1 class="charname">
            <input type="text" name="name" value="{{actor.name}}" placeholder="Group Name">
          </h1>
        </div>
      </div>
    </div>

    <section class="sheet-body">

      <!-- Members Tab -->
      <div class="tab members" data-group="primary" data-tab="members">
        <div class="member-drop-zone" style="border: 2px dashed #999; padding: 20px; margin: 10px 0; text-align: center;">
          <i class="fas fa-users" style="font-size: 2em; opacity: 0.5;"></i>
          <p style="margin: 10px 0 0 0; opacity: 0.7;">
            {{#if editable}}Drag actors here to add them to this group{{else}}Group Members{{/if}}
          </p>
        </div>

        {{#if resolvedMembers.length}}
        <div class="controls" style="margin: 10px 0; display: flex; gap: 10px;">
          {{#if isGM}}
          <button type="button" class="deploy-group" style="flex: 1;">
            <i class="fas fa-chess-board"></i> Deploy Group
          </button>
          {{/if}}
          <button type="button" class="short-rest" style="flex: 1;">
            <i class="fas fa-coffee"></i> Short Rest
          </button>
          <button type="button" class="long-rest" style="flex: 1;">
            <i class="fas fa-bed"></i> Long Rest
          </button>
        </div>

        <div class="member-list" style="display: flex; flex-direction: column; gap: 8px;">
          {{#each resolvedMembers as |member|}}
          <div class="member-item" data-uuid="{{member.uuid}}" style="display: flex; align-items: center; padding: 8px; border: 1px solid #ccc; border-radius: 4px; gap: 10px;">
            
            <div class="member-portrait" style="cursor: pointer; flex-shrink: 0;">
              <img src="{{member.img}}" width="36" height="36" title="{{member.name}}" style="border-radius: 4px; {{#if member.missing}}opacity: 0.5; filter: grayscale(100%);{{/if}}">
            </div>

            <div class="member-info" style="flex-grow: 1;">
              <div class="member-name" style="cursor: pointer; font-weight: bold; font-size: 14px;">
                {{member.name}}
                {{#if member.missing}}<span style="color: #d9534f; font-size: 0.9em;">(Missing)</span>{{/if}}
              </div>
              
              {{#if member.canView}}
              <div class="member-stats" style="display: flex; gap: 12px; font-size: 12px; margin-top: 4px;">
                <span><i class="fas fa-heart"></i> {{member.hp.value}}/{{member.hp.max}}</span>
                <span><i class="fas fa-bolt"></i> {{member.stamina.value}}/{{member.stamina.max}}</span>
                <span><i class="fas fa-running"></i> {{member.speed}}</span>
                {{#if member.fatigue}}<span style="color: #d9534f;"><i class="fas fa-exclamation-triangle"></i> Fatigue {{member.fatigue}}</span>{{/if}}
              </div>
              {{/if}}
            </div>

            {{#if ../editable}}
            <button type="button" class="member-delete" style="flex-shrink: 0;" title="Remove">
              <i class="fas fa-times"></i>
            </button>
            {{/if}}
          </div>
          {{/each}}
        </div>
        {{else}}
        <p style="text-align: center; opacity: 0.7; margin-top: 20px;">No members in this group.</p>
        {{/if}}
      </div>

      <!-- Inventory Tab -->
      <div class="tab inventory" data-group="primary" data-tab="inventory">
        <h3>Group Inventory</h3>
        <p style="opacity: 0.7; font-size: 12px; margin-bottom: 10px;">Items stored in the group (not tracked from members)</p>
        
        <div class="inventory-section">
          <h4>Weapons</h4>
          <ol class="item-list">
            {{#each actor.weapon as |item|}}
            <li class="item" data-item-id="{{item._id}}">
              <img src="{{item.img}}" title="{{item.name}}" width="24" height="24">
              <span class="item-name">{{item.name}}</span>
              <span class="item-qty">Qty: {{item.system.quantity}}</span>
              {{#if ../editable}}<a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>{{/if}}
            </li>
            {{/each}}
          </ol>
        </div>

        <div class="inventory-section">
          <h4>Armor</h4>
          <ol class="item-list">
            {{#each actor.armor as |item|}}
            <li class="item" data-item-id="{{item._id}}">
              <img src="{{item.img}}" title="{{item.name}}" width="24" height="24">
              <span class="item-name">{{item.name}}</span>
              {{#if ../editable}}<a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>{{/if}}
            </li>
            {{/each}}
          </ol>
        </div>

        <div class="inventory-section">
          <h4>Gear</h4>
          <ol class="item-list">
            {{#each actor.gear as |item|}}
            <li class="item" data-item-id="{{item._id}}">
              <img src="{{item.img}}" title="{{item.name}}" width="24" height="24">
              <span class="item-name">{{item.name}}</span>
              <span class="item-qty">Qty: {{item.system.quantity}}</span>
              {{#if ../editable}}<a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>{{/if}}
            </li>
            {{/each}}
          </ol>
        </div>
      </div>

      <!-- Travel Tab -->
      <div class="tab travel" data-group="primary" data-tab="travel">
        <h3>Travel & Movement</h3>
        
        <div class="travel-stats" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
          <div class="stat-card">
            <h4>Average Speed</h4>
            <div style="font-size: 24px; font-weight: bold;">{{averageSpeed}} m/round</div>
            <p style="opacity: 0.7; font-size: 12px;">Calculated from all members</p>
          </div>

          <div class="stat-card">
            <h4>Travel Pace</h4>
            <div style="display: flex; align-items: center; gap: 10px;">
              <button type="button" class="change-pace" style="flex: 1; padding: 10px; font-size: 16px; font-weight: bold;">
                {{#if (eq currentPace "fast")}}Fast{{/if}}
                {{#if (eq currentPace "normal")}}Normal{{/if}}
                {{#if (eq currentPace "slow")}}Slow{{/if}}
              </button>
            </div>
            <p style="opacity: 0.7; font-size: 12px; margin-top: 5px;">Click to cycle pace</p>
          </div>
        </div>

        <div class="pace-reference" style="margin-top: 20px;">
          <h4>Travel Pace Reference (RAW Chapter 1)</h4>
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="border-bottom: 2px solid #ccc;">
                <th style="padding: 8px; text-align: left;">Pace</th>
                <th style="padding: 8px; text-align: center;">Speed (km/h)</th>
                <th style="padding: 8px; text-align: center;">Daily (8 hours)</th>
                <th style="padding: 8px; text-align: left;">Effect</th>
              </tr>
            </thead>
            <tbody>
              <tr style="{{#if (eq currentPace 'fast')}}background: rgba(0,100,200,0.1);{{/if}}">
                <td style="padding: 8px;"><b>Fast</b></td>
                <td style="padding: 8px; text-align: center;">7 km/h</td>
                <td style="padding: 8px; text-align: center;">56 km</td>
                <td style="padding: 8px;">−20 to Observe</td>
              </tr>
              <tr style="{{#if (eq currentPace 'normal')}}background: rgba(0,100,200,0.1);{{/if}}">
                <td style="padding: 8px;"><b>Normal</b></td>
                <td style="padding: 8px; text-align: center;">5 km/h</td>
                <td style="padding: 8px; text-align: center;">40 km</td>
                <td style="padding: 8px;">—</td>
              </tr>
              <tr style="{{#if (eq currentPace 'slow')}}background: rgba(0,100,200,0.1);{{/if}}">
                <td style="padding: 8px;"><b>Slow</b></td>
                <td style="padding: 8px; text-align: center;">3 km/h</td>
                <td style="padding: 8px; text-align: center;">24 km</td>
                <td style="padding: 8px;">Can move stealthily</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Details Tab -->
      <div class="tab details" data-group="primary" data-tab="details">
        <div class="editor-section">
          <h3>Description</h3>
          {{editor actor.system.enrichedDescription target="system.description" engine="prosemirror" button=true owner=owner editable=editable}}
        </div>

        <div class="editor-section" style="margin-top: 20px;">
          <h3>Notes</h3>
          {{editor actor.system.enrichedNotes target="system.notes" engine="prosemirror" button=true owner=owner editable=editable}}
        </div>
      </div>

    </section>
  </div>
</form>
