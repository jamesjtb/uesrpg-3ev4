_id: b2K1CAkdbH7vutmq
name: Lore Roll
type: script
author: KoTybT0dunV5wS6T
img: icons/sundries/books/book-stack.webp
scope: global
command: |-
  // Safe defensive access to actor system properties
  const actorSys = token.actor?.system || {};
  const lucky = actorSys.lucky_numbers || {};
  const unlucky = actorSys.unlucky_numbers || {};
  const loreVal = token.actor?.items?.find(e => e.name === 'Lore')?.system?.value ?? 0;
  
  let d = new Dialog({
      title: "Apply Roll Modifier",
      content: `<form>
                  <div class="dialogForm">
                  <label><b>Lore Modifier: </b></label><input placeholder="ex. -20, +10" id="playerInput" value="0" style=" text-align: center; width: 50%; border-style: groove; float: right;" type="text"></input></div>
                </form>`,
      buttons: {
        one: {
          label: "Roll!",
          callback: html => {
            const playerInput = parseInt(html.find('[id="playerInput"]').val());
            let roll = new Roll("1d100");
            roll.roll({async:false});
          
            if (roll.total === lucky.ln1 || roll.total == lucky.ln2 || roll.total == lucky.ln3 || roll.total == lucky.ln4 || roll.total == lucky.ln5) {
              const content = `Rolls for <b>Lore</b>!
              <p></p><b>Target Number: [[${loreVal}]]</b> <p></p>
              <b>Result: [[${roll.total}]]</b><p></p>
              <span style='color:green; font-size:120%;'> <b>LUCKY NUMBER!</b></span>`
          
              roll.toMessage({ user: game.user._id, speaker: ChatMessage.getSpeaker(), content: content});
          
            } else if (roll.total === unlucky.ul1 || roll.total == unlucky.ul2 || roll.total == unlucky.ul3 || roll.total == unlucky.ul4 || roll.total == unlucky.ul5) {
              const content = `Rolls for <b>Lore</b>!
              <p></p><b>Target Number: [[${loreVal}]]</b> <p></p>
              <b>Result: [[${roll.total}]]</b><p></p>
              <span style='color:red; font-size:120%;'> <b>UNLUCKY NUMBER!</b></span>`
          
              roll.toMessage({ user: game.user._id, speaker: ChatMessage.getSpeaker(), content: content});
          
            } else if (actorSys.wounded === true) {
              const content = `Rolls for <b>Lore</b>!
              <p></p><b>Target Number: [[${loreVal}]] </b> <p></p>
              <b>Result: [[${roll.total}]]</b><p></p>
              ${roll.total<=(loreVal + playerInput) ? " <span style='color:green; font-size: 120%;'> <b>SUCCESS!</b></span>" : " <span style='color:red; font-size: 120%;'> <b>FAILURE!</b></span>"}`
          
              roll.toMessage({ user: game.user._id, speaker: ChatMessage.getSpeaker(), content: content});
    
            } else {
              const content = `Rolls for <b>Lore</b>!
              <p></p><b>Target Number: [[${loreVal}]]</b> <p></p>
              <b>Result: [[${roll.total}]]</b><p></p>
              ${roll.total<=(loreVal + playerInput) ? " <span style='color:green; font-size: 120%;'> <b>SUCCESS!</b></span>" : " <span style='color:red; font-size: 120%;'> <b>FAILURE!</b></span>"}`
          
              roll.toMessage({ user: game.user._id, speaker: ChatMessage.getSpeaker(), content: content});
              }
          }
        },
        two: {
          label: "Cancel",
          callback: html => console.log("Cancelled")
        }
      },
      default: "one",
      close: html => console.log()
    });
    d.render(true);
folder: null
sort: 0
flags:
  core:
    sourceId: Macro.012GfE5OphzghK1U
_stats:
  coreVersion: '12.331'
  systemId: null
  systemVersion: null
  createdTime: null
  modifiedTime: null
  lastModifiedBy: null
  compendiumSource: null
  duplicateSource: null
ownership:
  default: 0
  inSimu0FutxmlwqN: 3
  KoTybT0dunV5wS6T: 3
_key: '!macros!b2K1CAkdbH7vutmq'

